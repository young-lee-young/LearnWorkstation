# 语言特性

* python语言特性
* python语言优缺点
* 优缺点
* 鸭子类型
* 猴子补丁
* 自省
* python2和python3区别
* python解释器


### python语言特性

python动态强类型语言

* 动态和静态语言

动态语言：不用显示声明语言类型，运行时确定
静态语言：显示声明语言类型，编译时确定

* 强类型和弱类型语言

强类型：不同类型变量之间不可以相加
弱类型：不同类型变量之间可以相加

* 解释型语言和编译型语言区别

解释型语言：解释器逐行将源代码解释成机器码文件，并执行
编译型语言：经过编译器编译成机器码


### python语言优缺点

* python语言优点

1. 胶水语言，轮子多，应用广泛
2. 语言灵活，生产力高

* 缺点

1. 性能问题，代码维护问题，python2/3兼容问题


### 鸭子类型

如果一只鸟走起来像鸭子，游起来像鸭子，叫起来像鸭子，我就管这只鸟叫鸭子

如果一个对象实现了__getitem__方法，python就会把它当做一个collection，就可以在这个对象上使用切片，获取子项等方法
如果一个对象实现了__iter__和__next__方法，python就会认为它是一个iterator，就可以在这个对象上通过循环来获取各个子项


### 猴子补丁

运行时类型替换


### 自省：运行时判断一个对象类型

inspect模块

实例化的为方法，没有实例化的为函数

```python
import inspect


def test_func():
    pass


is_func = inspect.isfunction(test_func)
is_method = inspect.ismethod(test_func)
```


### python2和python3区别

* print：python2中的print是语句，python3中的print是函数

* input：python2 input输入是int类型，raw_input是str类型，python3中都用input，是str类型

* 除法：python2中/带小数点表示真除，不带小数点表示地板除，//表示地板除、%取余数，python3中/表示真除、//表示地板除，%表示取余

* xrange：python2中range返回列表，xrange返回可迭代对象，python3中range返回可迭代对象，没有xrange（python3一切返回迭代器）

* 异常处理：python2：except ValueError, e，python3：except ValueError as e

* long：python2中有long类型，python3中没有long类型

* python调用父类方法

```python
# python2
super(当前类名, self).hello()

# python3
super().hello()
```

* python3新加类型注解，type hint

* Chained exceptions，python3重新抛出异常不会丢失栈信息

```python
name = 'leeyoung'

try:
    new_num = int(name)
except ValueError:
    raise NotImplementedError('this is a test error') from ValueError
```

* python3新增

1. yield from链接子生成器
2. asyncio内置库，async/await原生协程支持异步编程
3. 内置库：enum，mock，asyncio，ipaddress，concurrent.futures

* 生成的pyc文件统一放到__pycache__下


### python解释器

Cpython：
Jython：Java实现
IronPython：
PyPy：
RubyPython：
Brython：


### GIL锁（Global Interpreter Lock）

* 什么是GIL（全局解释器锁）

1. Cpython解释器的内存管理并不是线程安全的
2. Cpython使用锁机制避免多个线程同时执行字节码

* GIL影响

1. 限制了多核执行，同一时间只能有一个线程执行字节码
2. CPU密集程序难以利用多核优势
3. IO期间会释放GIL，对CPU密集影响较大，对IO密集程序影响不大

* 规避GIL影响

1. CPU密集可以用多进程 + 进程池
2. IO密集使用多线程、协程
3. cython扩展
