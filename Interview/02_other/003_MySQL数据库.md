# MySQL数据库


### 事务

* ACID

1. 原子性：要么都成功，要么都失败
2. 一致性：事务开始和结束之后数据完整性没有被破坏
3. 隔离性：允许多个事务同时对数据库进行修改和读写
4. 永久性：事务结束后，修改永久，不会丢失



* 不对事务进行并发控制，可能会产生四种异常

1. 幻读：一个事务第二次查询出现第一次没有的结果
2. 非重复读：一个事务重复读两次得到不同结果
3. 脏读：一个事务读取到另一个事务没有提交的修改
4. 丢失修改：并发写入造成其中一些修改丢失



* 事务隔离级别

1. 读未提交：别的事物可以读取到未提交改变
2. 读已提交：只能读取已经提交的事物（解决脏读）
3. 可重复读：同一个事务先后查询结果相同（解决非重复读）
4. 串行化：事务完全串行化执行，隔离级别最高，执行效率最低（解决幻读）



* 乐观锁与悲观锁

乐观锁：直接改数据，更新的时候发现数据已经改变就回滚
悲观锁：先锁数据，再更新


### 索引

* 什么是索引

数据表中一个或者多个列进行排序的数据结构

索引能够大幅度提升检索速度，创建、更新索引本身也会耗费空间和时间

* B-tree和B+tree

B-tree

1. 多路平衡查找树（每个节点最多m（m >=2）个孩子，称为m阶或者度）
2. 叶节点具有相同的深度
3. 节点中的key从左到右递增

B-tree每个节点都存储键和数据，叶子节点指针为空
B+tree，只有叶子节点存储数据，叶子节点包含所有键值，叶子节点不存储指针


* 索引类型

1. 普通索引
2. 唯一索引
3. 多列索引
4. 主键索引
5. 全文索引（InnoDB不支持）

* 什么时候创建索引

1. 经常用作查询条件的字段
2. 经常用作表连接的字段
3. 经常出现在order by、group by之后的字段

* 创建索引注意事项

1. 非空字段，MySQL很难对空值作查询优化
2. 区分度高，离散度大，作为索引的字段值尽量不要有大量相同值
3. 索引长度不要太长

* 什么时候索引失效：模糊匹配，类型隐转，最左匹配

1. 以%开头的LIKE语句，模糊搜索
2. 出现隐式类型转换
3. 没有满足最左前缀匹配原则

* 聚簇索引和非聚簇索引

1. 聚簇还是非聚簇指的是B+tree叶节点存的是指针还是数据记录（聚簇索引存数据，非聚簇索引存指针）
2. MyISAM索引和数据分离，使用的是非聚簇索引
3. InnoDB数据文件就是索引文件，主键索引就是聚簇索引

* 慢查询

1. show_query_log_file开启并且查询慢查询日志
2. explain排查索引问题
