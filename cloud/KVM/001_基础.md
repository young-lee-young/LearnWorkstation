# KVM使用



### 安装

```sh
# 检查宿主机是否支持虚拟化
grep --color -E '(vmx|svm)' /proc/cpuinfo

# 安装软件
sudo yum install qemu-kvm qemu-kvm-tools virt-manager libvirt

# 启动服务
sudo /etc/init.d/libvirtd start
```



### 配置网络

* 配置网络

网络默认使用NAT模式

网络配置文件位置/usr/share/libvirt/networks/default.xml

```bash
# 定义网络
virsh net-define netname.xml
# 移除网络
virsh net-undefine netname
```

* 启动关闭网络

```bash
# 启动网络
virsh net-start netname
# 停止网络
virsh net-destroy netname
```

* 查看网络

```bash
# 查看启用网络
virsh net-list
# 查看所有网络
virsh net-list --all
```


### 虚拟机定义

* 配置虚拟机

```bash
# 定义虚拟机
virsh define vmconfig.xml
# 移除虚拟机
virsh undefine vmname
```

```bash
# 开启虚拟机
virsh start vmname
# 销毁虚拟机
virsh destroy vmname
```

* 查看虚拟机

```bash
# 查看启动虚拟机
virsh list
# 查看所有虚拟机
virsh list --all
```

* 查看虚拟机VNC

```bash
virsh vncdisplay --domain vmname
# 这里需要注意，如果结果是 :0 表示全局监听，外部访问不到，如果是 127.0.0.1:0 表示内部监听
```


