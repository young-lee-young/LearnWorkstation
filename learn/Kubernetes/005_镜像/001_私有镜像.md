### Kubernetes 中使用私有镜像

* 登录 Docker，登录后会在 ~/.docker/config.json 生成凭证

```bash
docker login $registry_url --username $username --password $password
```

```json
{
    "auths": {
        "registry_url": {
            "auth": "xxx"
        }
    }
}
```

* 将凭证 base64 编码

```bash
cat ~/.docker/config.json | base64
```

* 创建 Secret

其中 .dockerconfigjson 内容为上面凭证编码为 base64 后的结果，type 为 "kubernetes.io/dockerconfigjson"

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: $secret_name
  namespace: $namespace
data:
  .dockerconfigjson: $base64
type: kubernetes.io/dockerconfigjson
```

```bash
kubectl apply -f secret.yaml
```

查看 Docker 凭证

```bash
kubectl get secret $secret_name -n $namespace --output="jsonpath={.data.\.dockerconfigjson}" | base64 --decode
```

* 使用私有仓库镜像创建 Pod

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: $pod_name
  namespace: $namespace
spec:
  containers:
  - name: $container_name
    image: $private_registry_image
  imagePullSecrets:
  - name: $secret_name
```
