# 虚拟机重启后清理容器


### kubernetes

* master

```bash
# 清理 api server 容器（1个 api server 容器，1个 pause 容器）
sudo docker ps -a | grep kube-apiserver-master | grep Exited | awk '{print $1}' | xargs -i sudo docker rm {}

# 清理 etcd 容器（1个 etcd 容器，1个 pause 容器）
sudo docker ps -a | grep etcd-master | grep Exited | awk '{print $1}' | xargs -i sudo docker rm {}

# 清理 controller 容器（1个 controller 容器，1个 pause容器）
sudo docker ps -a | grep kube-controller-manager-master | grep Exited | awk '{print $1}' | xargs -i sudo docker rm {}

# 清理 scheduler 容器（1个 scheduler 容器，1个 pause 容器）
sudo docker ps -a | grep kube-scheduler-master | grep Exited | awk '{print $1}' | xargs -i sudo docker rm {}

# 清理 coredns 容器（2个 coredns 容器，2个 pause 容器）
sudo docker ps -a | grep coredns | grep Exited | awk '{print $1}' | xargs -i sudo docker rm {}
```

* master && node

```bash
# 清理 proxy 容器（1个 proxy 容器，一个 pause 容器）
sudo docker ps -a | grep kube-proxy | grep Exited | awk '{print $1}' | xargs -i sudo docker rm {}
```

```bash
# 清理 weave 容器（1个 init 容器，2个 weave 容器，1个 pause 容器）
sudo docker ps -a | grep weave | grep Exited | awk '{print $1}' | xargs -i sudo docker rm {}
```

* node1

```bash
# 清理 dashboard 容器（1个 dashboard 容器，1个 pause 容器）
sudo docker ps -a | grep kubernetes-dashboard | grep Exited | awk '{print $1}' | xargs -i sudo docker rm {}
```

* node2

```bash
# 清理 dashboard metrics scraper 容器（1个 scraper 容器，1个 pause容器）
sudo docker ps -a | grep dashboard-metrics-scraper | grep Exited | awk '{print $1}' | xargs -i sudo docker rm {}
```


### rook ceph

* master && node

```bash
# 清理 discover 容器（1个 discover 容器，1个 pause 容器）
sudo docker ps -a | grep rook-discover | grep Exited | awk '{print $1}' | xargs -i sudo docker rm {}

# 清理 mon 容器（1个 chown 容器，2个 mon 容器，1个 pause 容器）
sudo docker ps -a | grep rook-ceph-mon | grep Exited | awk '{print $1}' | xargs -i sudo docker rm {}

# 清理 crash collector 容器（1个 mkdir 容器，1个 chown 容器，1个 collector 容器，1个 pause 容器）
sudo docker ps -a | grep rook-ceph-crashcollector | grep Exited | awk '{print $1}' | xargs -i sudo docker rm {}


#（3个 plugin 容器，1个 pause 容器）
sudo docker ps -a | grep csi-cephfsplugin | grep Exited | awk '{print $1}' | xargs -i sudo docker rm {}

# 清理 rbd plugin 容器（3个 plugin 容器，1个 pause 容器）
sudo docker ps -a | grep csi-rbdplugin | grep Exited | awk '{print $1}' | xargs -i sudo docker rm {}


# 清理 osd prepare 容器（2个 prepare 容器，1个 pause 容器）
sudo docker ps -a | grep rook-ceph-osd-prepare | grep Exited | awk '{print $1}' | xargs -i sudo docker rm {}

# 清理 osd 容器（1个 bash 容器，1个 chown 容器，1个 osd 容器，1个 pause 容器）
sudo docker ps -a | grep rook-ceph-osd | grep Exited | awk '{print $1}' | xargs -i sudo docker rm {}
```

* 其中2个节点

```bash
#（6个 provisioner 容器，1个 pause 容器）
sudo docker ps -a | grep csi-cephfsplugin-provisioner | grep Exited | awk '{print $1}' | xargs -i sudo docker rm {}

#（6个 provisioner 容器，1个 pause 容器）
sudo docker ps -a | grep csi-rbdplugin-provisioner | grep Exited | awk '{print $1}' | xargs -i sudo docker rm {}
```

* node1

```bash
# 清理 operator 容器（1个 operator 容器，1个 pause 容器）
sudo docker ps -a | grep rook-ceph-operator | grep Exited | awk '{print $1}' | xargs -i sudo docker rm {}
```

* node2

```bash
# 清理 mgr 容器（1个 chown 容器，1个 mgr 容器，1个 pause 容器）
sudo docker ps -a | grep rook-ceph-mgr | grep Exited | awk '{print $1}' | xargs -i sudo docker rm {}

# 清理 tools 容器（1个 tools 容器，1个 pause 容器）
sudo docker ps -a | grep rook-ceph-tools | grep Exited | awk '{print $1}' | xargs -i sudo docker rm {}
```
