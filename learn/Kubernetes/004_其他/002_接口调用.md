### 接口调用过程


* 创建 service account

```bash
kubectl create sa $sa_name

# 查看 service account，service account 的 Tokens 为空
kubectl describe sa $sa_name
```


* 创建 secret

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: $secret_name
  annotations:
    kubernetes.io/service-account.name: $sa_name
type: kubernetes.io/service-account-token
```

```bash
kubectl apply -f $secret_yaml
```


* 检查 service account

```bash
# 查看 service account
kubectl describe sa $sa_name

# 查看 secret，有 token 值
kubectl describe secret $secret_name
```


* 创建角色绑定 

```bash
# 查看角色
kubectl get clusterroles

# 创建 rolebinding
kubectl create rolebinding $rolebinding_name --clusterrole $clusterrole_name --serviceaccount default:$serviceaccount_name

# 查看 rolebinding
kubectl get rolebinding
```


* 获取证书

```bash
cluster/kubectl.sh get secret $secret_name -o jsonpath="{.data['ca\.crt']}" | base64 -d > /tmp/ca.crt
```


* 获取 token

```bash
cluster/kubectl.sh describe secret $secret_name
```
