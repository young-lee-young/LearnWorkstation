# 交换机


### 交换机分层结构

1. 接入层：用户接入，接入安全，访问控制
2. 汇聚层：流量汇聚，链路冗余，设备冗余，路由选择
3. 核心层：高速转发，服务器接入，路由选择
4. 出口层：广域网接入，出口策略，带宽控制


### 交换机功能

1. 地址学习
2. 数据转发
3. 避免环路


### 接口类型

1. Access：连接终端、服务器
2. Trunk：承载多VLAN数据，Trunk两端交换机需采用相同的干道协议，一般在交换机之间或交换机与路由器之间
3. Hybrid：


Access接口接收数据帧规则：如果数据帧不带TAG，交换机接受并打TAG；如果数据帧带TAG，如果TAG中的vlan_id和接口设置的vlan_id相同，接受数据帧，不同，丢弃数据帧
Access接口发送数据帧规则：将TAG从数据帧中删除，将原始数据帧发送出去

Trunk接口接收数据帧规则：如果数据帧不带TAG，交换机接受并打TAG，如果TAG vlan_id在接受列表中，接收数据帧，否则丢弃；如果数据帧带TAG，检查TAG中的vlan_id在是否在接受列表中，如果在，接收数据帧，否则丢弃
Trunk接口发送数据帧规则：如果TAG中vlan_id与接口vlan_id相同，将TAG去掉，发送出去；如果不相同，直接将带有TAG的数据帧发送出去


### 交换机

* 查看MAC地址表

```sh
# 特权模式

show mac-address-table
```


### 交换机端口安全

* 控制计算机数量

```sh
# 全局模式

interface ethernet 1/0

# 说明是接入计算机接口
switchport mode access

# 启用安全
switchport port-security

# 违反安全shutdown掉接口
switchport port-security violation shutdown

# 接入两个计算机
switchport port-security maximum 2
```

* 绑定MAC地址

```sh
interface range ethernet 0/1 - 4

switchport mode access

switchport port-security

switchport port-security violation shutdown

# 保存现在的各个端口连接的MAC地址
switchport port-security mac-address sticky
```


### 生成树协议

* 生成树操作

1. 确定根交换机（选优先级小的，优先级相同选择MAC地址小的）
2. 选择根端口（连接到根交换机的为根端口）
3. 每根网线选择一个指定端口，另一个端口自动成为非指定端口

根交换机所有端口都是指定端口，其他交换机与根交换机相连的端口是根端口，


* 查看交换机端口

```sh
# 特权模式

show spanning-tree
```

* 修改交换机优先级，数字越小优先级越高

```sh
# 全局模式

spanning-tree vlan 1 priority 4096
```

* 关闭生成树协议

```sh
no spanning-tree vlan 1
```
