# netfilter 基础


### 内核空间 Load Balancer 实现方式

* iptables

```bash
iptables -t nat -N myservice

iptables -t nat -A OUTPUT -d 10.10.0.1/16 -j myservice
```

```bash
# random 模式
iptables -t nat -A myservice -d 10.10.0.1 -m statistic --mode random --probability 0.3333 -j DNAT --to-destination 172.18.1.2

iptables -t nat -A myservice -d 10.10.0.1 -m statistic --mode random --probability 0.5 -j DNAT --to-destination 172.18.1.3

iptables -t nat -A myservice -d 10.10.0.1 -j DNAT --to-destination 172.18.1.4
```

```bash
# nth（Round Robin）
iptables -t nat -A myservice -d 10.10.0.1 -m statistic --mode nth --every 3 --packet 0 -j DNAT --to-destination 172.18.1.2

iptables -t nat -A myservice -d 10.10.0.1 -m statistic --mode nth --every 2 --packet 0 -j DNAT --to-destination 172.18.1.3

iptables -t nat -A myservice -d 10.10.0.1 -j DNAT --to-destination 172.18.1.4
```


* ipvs


* ebpf
