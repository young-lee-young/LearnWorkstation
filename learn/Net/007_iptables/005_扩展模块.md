# iptables 扩展模块


### 按包状态匹配

-m state --state $状态

* 示例

```bash
# 🌰
iptables -t filter -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
```

* 注意⚠️

状态：NEW、RELATED、ESTABLISHED（连接态）、INVALID


### 按 mac 地址匹配

-m mac --mac-source $mac

* 示例

```bash
# 🌰：将'源 mac 地址' 发送的包拒绝
iptables -t filter -A INPUT -m mac --mac-source 52:54:00:b8:e8:6c -j REJECT
```

* 注意⚠️

报文经过路由后，数据包中的'源 mac 地址'信息会被替换，所以在路由后的 iptables 中使用 'mac 模块' 是没有意义的


### 按包速率匹配

-m limit --limit 速率

* 示例

```bash
# 🌰：将转发到 192.168.0.1 的数据包限速为 100/s
iptables -t filter -A FORWARD -d 192.168.0.1 -m limit --limit 100/s -j DROP
```


### 多端口匹配

一次匹配多个端口，可以区分源端口、目的端口或不指定端口

-m multiport --sport 端口1,端口2,...,端口n

-m multiport --dport 端口1,端口2,...,端口n

-m multiport --ports 端口1,端口2,...,端口n

* 示例

```bash
# 🌰：允许多个 TCP 端口通过
iptables -t filter -A INPUT -p tcp -m multiport --dports 22,80,443 -j ACCEPT
```

* 注意⚠️

必须配合 -p 参数使用
