# iptables 操作命令


### 基础

* 语法

```bash
iptables [-t 表名] 操作命令 [链名] [匹配条件] [-j 目标动作或跳转]
```


### -A

* 作用：追加一条规则（放到最后）

* 示例

```bash
# 🌰：在 filter 表的 INPUT 链中追加一条规则，丢弃所有进入的包
iptables -t filter -A INPUT -j DROP
```


### -I

* 作用：插入一条规则

* 示例

```bash
# 🌰：在 filter 表的 INPUT 链中插入一条规则（位于第 2 条），拒绝所有进入的包
iptables -t filter -A INPUT 2 -j REJECT
```


### -L

* 作用：查看规则

* 示例

```bash
# 🌰：查看 filter 表所有链的规则
iptables -t filter -L

# 🌰：查看 filter 表 INPUT 链的规则
iptables -t filter -L INPUT
```

* 其他参数

v：显示详细信息，包括每条规则的匹配包数量和匹配字节数
x：在 v 的基础上，禁止自动单位换算
n：只显示 IP 和端口号，不显示域名和服务名称

注意⚠️：参数要在 L 前面

[iptables -vnL](image/003_列举规则.png)

```bash
iptables -t filter -vxnL INPUT
```


### -D

* 作用：删除一条规则

* 示例

```bash
# 🌰：按规则号删除，删除 filter 表 INPUT 链里的第一条规则
iptables -t filter -D INPUT 1

# 🌰：按内容删除，删除 filter 表 INPUT 链内容为 '-s 192.168.0.1 -j DROP' 的规则
iptables -t filter -D INPUT -s 192.168.0.1 -j DROP
```

* 注意⚠️

1. 按序号匹配删除时，规则号码 <= 已有规则数，否则报错（iptables: Index of deletion too big.）
2. 按内容匹配删除时，确保规则存在，否则报错（iptables: Bad rule (does a matching rule exist in that chain?).）
3. 按内容匹配删除时，如果有多条相同的规则，只删除规则号最小的一条


### -P

* 作用：设置某个链的默认规则

* 查看[默认规则](image/002_默认规则.png)

* 示例

```bash
# 🌰：修改 filter 表 INPUT 链的默认规则为 DROP
iptables -t filter -P INPUT DROP
```


### -F

* 作用：清空规则

* 示例

```bash
# 🌰：清空 filter 表 INPUT 链的规则
iptables -t filter -F INPUT

# 🌰：清空 filter 表所有链的规则
iptables -t filter -F
```

* 注意⚠️

1. -F 只清空链中规则，不影响 -P 设置的默认规则
