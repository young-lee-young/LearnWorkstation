# 可靠传输 - 选择重传协议


### 选择重传协议（SR，Selective Request）

* 选择重传协议

为了提高性能，可设法只重传出现误码的数据分组。因此，接收窗口的尺寸 Wr 不应再等于1（应该大于1），
以便接收方先收下失序到达但无误码并且序号落在接收窗口内的那些数据分组，等到所缺分组收齐后再一并送交上层


* 实现原理

1. 发送方发送窗口内的所有数据帧，每个帧启动一个超时定时器。接收到确认帧后，将帧标记为发送成功，如果是最左数据帧，窗口向前移动
2. 接收方接收所有接收窗口内的帧，接收一个帧缓存数据帧，并发送确认帧 ACK。如果数据帧有误或者丢失，接收方发送否认帧 NAK，发送方收到 NAK 后，立即重发该帧
3. 发送方只重传出错或超时数据帧


* 窗口大小

1. 发送发窗口大小：1 < Wt <= 2^(n - 1)，n是帧序号的比特数量，Wt > 2^(n - 1) 会造成接收方无法分辨新、旧数据帧的问题
2. 接收方窗口大小：1 < Wr < Wt，Wr > Wt没有意义
