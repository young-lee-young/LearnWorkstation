# 可靠传输 - 停止等待协议


### 停止等待协议（Stop and Wait）

* 实现原理

1. 每发送完一个数据帧就停止发送，等待对方确认
2. 收到确认后再发送下一数据帧
3. 每次发送完一个数据帧，将数据帧拷贝一份放入缓存，并启动重传计时器，当计时器超时还未收到确认，就重传该数据帧


* 解决误码方式

1. 接收端检测到数据分组有误码时，将其丢弃并等待发送方的超时重传。对于误码率较高的点对点链路，为使发送方尽早重传，也可给发送方发送 NAK 分组
2. 为了让**接收方**能够判断所收到的 数据分组 是否重复，需要给 数据分组 编号。由于 停止-等待协议 的停等特性，只需 1 个比特，即编号 0 和 1
3. 为了让**发送方**能够判断所收到的 ACK分组 是否重复，需要给 ACK分组 编号。只需要 1 个比特，即编号 0 和 1
4. 超时计时器设置的重传时间应仔细选择，一般选为略大于 "从发送方到接收方的平均往返时间"


### 停止等待协议信道利用率

* 信道利用率计算

数据帧发送时延：Td，取决于发送速率和帧长度
确认帧发送时延：Ta，取决于发送速率和帧长度
帧往返时延：RTT，数据帧从发送方到接收方时间 + 确认帧从接收方到发送方时间

U = Td / (Td + RTT + Ta)


* 利用率

信道利用率低，当往返时延RTT远大于数据帧发送时延Td时，信道利用率非常低
