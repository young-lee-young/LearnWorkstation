# HTTP 历史版本


### 发展史

[HTTP 发展史](HTTP发展史.png)


### HTTP 1.0

* 特点

1. 每次请求新建连接，连接不能复用


* 问题

1. 无法复用连接
2. 队头阻塞


### HTTP 1.1

* 特点

1. 引入了长连接（增加 Connection 字段，设置 keep-alive），多个请求复用一个连接


* 管道化（pipelining）

服务端必须按照客户端请求顺序依次回送相应的结果（第一个响应发送完才能发送第二个响应），保证客户端能够区分出每次请求的响应内容


* 问题

1. 队头阻塞


* 队头阻塞（head of line blocking）

问题：HTTP 1.1 每个 TCP 连接有一个队列，请求按照顺序发送和接收，如果对头的请求不能收到响应的资源，将会阻塞后面的请求

解决：可以通过增加连接数解决，但是连接数有限制，谷歌浏览器支持最大 6 个并行连接


* 数据传输大小

HTTP 1.1 相较于 HTTP 1.0，数据传输增加，因为 HTTP 1.1 使用了 keep-alive，每次请求都会在头部声明（声明本次请求复用了上次请求的连接）


### HTTP 2.0

* 特点

1. 可以复用连接
2. 建立连接后，一次的请求和响应，称为**流**（stream）
3. 数据传输分为**二进制帧**片段


* 流：代表了一个完整的**请求-响应**数据交互过程

特点：

1. 流创建：流可以被客户端或服务器单方面建立、使用或共享
2. 流关闭：流可以被任意一方关闭
3. 双向性：同一个流内，可同时发送和接收数据
4. 有序性：**二进制帧**在流上的被发送与被接收都是按照顺序进行的
5. 并行性：**二进制帧**是并行传输的，不需要按顺序等待，每个帧都有顺序标号，最终会被按照顺序标号来合并


* 二进制分帧（binary framing layer）

HTTP 1.x 采用**文本格式**传输数据

HTTP 2.0 采用**二进制格式**传输数据，在 TCP 协议中，数据的传输单位是**数据报**，数据分为头部（header）和数据部分（data），

HTTP 2.0 把数据报的两大部分分成 header frame（头部帧） 和 data frame（数据帧），并将帧分割为更小的帧，采用**二进制编码**


* 头部压缩（header compression）

HTTP 请求和响应构成：状态行、头部、消息主体

在 HTTP 1.x 中，消息主体经过 gzip 压缩，状态行和头部没有进行压缩，以纯文本传输

在 HTTP 2.0 中，使用[头部压缩](头部压缩.png)，原理如下

1. 客户端与服务端维护一份相同的静态字典（static table）：包括常见的头部和值（在 RFC7541 中定义）
2. 客户端与服务端维护一份相同的动态字典（dynamic table）：可以动态添加内容
3. 支持基于静态哈夫曼码表的哈夫曼编码


* 问题

1. TCP 建立连接事件长
2. TCP 仍然存在队头阻塞问题


### HTTP 3.0

[HTTP 2.0 VS HTTP 3.0](HTTP%202.0%20VS%20HTTP%203.0.png)

* 特性

1. HTTP 底层基于**QUIC 协议**（Quick UDP Internet Connection，QUIC 底层基于 UDP），HTTP over QUIC


* QUIC 协议

1. 实现类似 TCP 流量控制、传输可靠性的功能
2. 实现快速握手功能：基于 UDP
3. 集成 TLS 1.3 加密
4. 解决 TCP 队头阻塞问题：QUIC 实现在同一物理连接上可以有多个独立的逻辑数据流，实现数据流的单独传输
5. 连接迁移：TCP 按 4 要素（客户端 IP、端口、服务端 IP、端口）确定一个连接，QUIC 根据一个 connection ID 确定一个连接
