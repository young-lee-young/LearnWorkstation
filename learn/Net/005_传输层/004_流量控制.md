# 流量控制


### 作用

控制发送方的发送速率不要太快，要让接收方来得及接收


### 流量控制方法

* 滑动窗口

滑动窗口是**接收数据端**使用的窗口大小，用来告知发送端接收端的**缓存大小**

发送方维护一个发送窗口、接收方维护一个接收窗口


* 流量控制

接收方返回的 ACK 报文包含接收窗口大小，利用窗口大小控制发送方的数据发送

发送方接收到 ACK 报文后，会把发送窗口大小设置为和接收端接收窗口大小一致


* 流量控制死锁产生

发送方收到**0窗口应答**，停止发送

接收者过一段时间又可以接收数据，向发送方发送非0窗口通告，若非0窗口通告丢失，发送者一直等待非0窗口通告，接收者一直等待发送方数据，产生死锁


* 死锁解决

每次发送方收到一个非0窗口应答，启动持续计时器，时间一到发送报文（0窗口探测报文，携带一字节数据）询问接收者窗口大小

若接收方仍然返回0窗口应答，发送方重制计数器继续等待；若接收方返回非0窗口应答，表示上一次通知报文丢失，此时发送发重置发送窗口后开始发送数据


### 问题

1. 接收窗口为 0 时，还能否接收 0 窗口报文

即使接收窗口为0，也必须接收0窗口探测报文段、确认报文段、携带紧急数据的的报文段

2. 0 窗口探测报文段丢失，死锁还能解决吗

能，0窗口探测报文段也有重传计时器，当重传计时器超时后，0窗口探测报文段会被重传
