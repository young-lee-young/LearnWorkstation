# RabbitMQ基础


### 安装

* Ubuntu

```bash
# 安准erlang依赖，报错Unable to locate package，是由于更新了软件源，执行sudo apt-get update命令
sudo apt-get install erlang

# 查看erlang版本
sudo erl

# 安装mq
sudo apt-get install rabbitmq-server

# 安装插件，后台管理，默认用户名密码均为guest
sudo rabbitmq-plugins enable rabbitmq_management

# 创建用户
sudo rabbitmqctl add_user 用户名 密码

# 将用户设置管理员权限，权限有administrator（超级管理员）、monitoring（监控者）、policymaker（策略制定者）、management（普通管理者）、none（其他）
sudo rabbitmqctl set_user_tags 用户名 administrator

# 权限配置
sudo rabbitmqctl set_permissions -p "/" 用户名 ".*" ".*" ".*"

# 查看权限
rabbitmqctl list_permissions -p "/" 
rabbitmqctl list_user_permissions 用户名

# 清除权限
rabbitmqctl clear_permissions -p "/" 用户名

# 删除用户
rabbitmqctl delete user 用户名

# 配置文件位置
/usr/lib/rabbitmq/lib/rabbitmq_server-3.5.7/ebin/rabbit.app

# 查看状态
rabbitmqctl status

# 查看mq的进程
ps -ef | grep rabbit

# 杀死进程，直接杀最后两个进程（守护进程和启动进程）
kill -9 进程号
![rabbitmq进程](rabbitprocess.png)

# 启动服务，/usr/lib/rabbitmq/lib/rabbitmq_server-3.5.7/sbin目录下，有rabbitmqctl、rabbitmq-defaults、rabbitmq-env、rabbitmq-plugins、rabbitmq-server命令
sudo rabbitmq-server start &
lsof -i:5672

# 清空队列
rabbitmqctl stop_app
rabbitmqctl reset
rabbitmqctl start_app

# 查看插件列表
rabbitmq-plugins list

# 启用插件，rabbitmq服务启动后，启动管控台插件，远程
rabbitmq-plugins enable rabbitmq_management

# 查看管控台
# 浏览器打开 地址:15672，输入账号密码

# 停止服务
sudo rabbitmq-server stop

# 重启服务
sudo rabbitmq-server restart
```

* Mac

```sh
# 安装rabbitmq
brew install rabbitmq

# 启动rabbitmq
brew services start rabbitmq（后台启动）
rabbitmq-server（直接启动）

# ./rabbitmq-plugins enable rabbitmq_management
```


### 基本命令

* 清空队列中的消息

```sh
# 查看队列和队列中消息个数
rabbitmqctl list_queues

# 停止应用
rabbitmqctl stop_app

# 清空队列
rabbitmqctl reset

# 开启应用
rabbitmqctl start_app
```


### 基础

* 介绍

Erlang语言开发
基于AMQP协议（Advanced Message Queuing Protocol 高级消息队列协议）

* 术语

1. 生产者（Applications，生产消息）
2. 消费者（Applications，消费消息）

* 核心概念

1. Virtual Host（虚拟地址，进行逻辑隔离）
2. Exchange（交换机，接收消息，根据规则转发到不同队列）
3. Binding（Exchange和Queue之间虚拟连接）
4. Routing key: 路由规则
