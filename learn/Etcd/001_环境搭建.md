### 集群搭建

* 所有服务器关闭防火墙和 SELINUX

* 下载安装

```bash
# 下载
wget https://github.com/etcd-io/etcd/releases/download/v3.3.11/etcd-v3.3.11-linux-amd64.tar.gz

# 解压
tar -xvf etcd-v3.3.11-linux-amd64.tar.gz

# 移动二进制文件到可执行文件路经下
sudo mv etcd-v3.3.11-linux-amd64/etcd* /usr/local/bin/

# 创建配置文件目录和数据文件目录
sudo mkdir -p /etc/etcd /var/lib/etcd

# 修改目录的权限
sudo chmod 777 /var/lib/etcd/ -R

# ETCD 配置文件
sudo vim /etc/etcd/etcd-cfg.yml

# ETCD 服务配置文件
sudo vim /etc/systemd/system/etcd.service
```

* etcd 配置文件：/etc/etcd/etcd-cfg.yml

master

```yaml
name: etcd-0
data-dir: /var/lib/etcd
listen-client-urls: http://192.168.26.20:2379,http://127.0.0.1:2379
advertise-client-urls: http://192.168.26.20:2379,http://127.0.0.1:2379
listen-peer-urls: http://192.168.26.20:2380
initial-advertise-peer-urls: http://192.168.26.20:2380
initial-cluster: etcd-0=http://192.168.26.20:2380,etcd-1=http://192.168.26.21:2380,etcd-2=http://192.168.26.22:2380
initial-cluster-token: etcd-cluster-token
initial-cluster-state: new
```

node1

```yaml
name: etcd-1
data-dir: /var/lib/etcd
listen-client-urls: http://192.168.26.21:2379,http://127.0.0.1:2379
advertise-client-urls: http://192.168.26.21:2379,http://127.0.0.1:2379
listen-peer-urls: http://192.168.26.21:2380
initial-advertise-peer-urls: http://192.168.26.21:2380
initial-cluster: etcd-0=http://192.168.26.20:2380,etcd-1=http://192.168.26.21:2380,etcd-2=http://192.168.26.22:2380
initial-cluster-token: etcd-cluster-token
initial-cluster-state: new
```

node2

```yaml
name: etcd-2
data-dir: /var/lib/etcd
listen-client-urls: http://192.168.26.22:2379,http://127.0.0.1:2379
advertise-client-urls: http://192.168.26.22:2379,http://127.0.0.1:2379
listen-peer-urls: http://192.168.26.22:2380
initial-advertise-peer-urls: http://192.168.26.22:2380
initial-cluster: etcd-0=http://192.168.26.20:2380,etcd-1=http://192.168.26.21:2380,etcd-2=http://192.168.26.22:2380
initial-cluster-token: etcd-cluster-token
initial-cluster-state: new
```

* 服务配置文件：/etc/systemd/system/etcd.service

在三个节点上部署服务

```
[Unit]
Description=etcd
After=network.target

[Service]
Type=notify
User=root
Environment="ETCD_UNSUPPORTED_ARCH=arm64" // 如果是 arm 平台，需要这一行
ExecStart=/usr/local/bin/etcd --config-file=/etc/etcd/etcd-cfg.yml
Restart=on-failure

[Install]
WantedBy=multi-user.target
EOF
```

* 启动服务

```bash
# 加载服务
sudo systemctl daemon-reload

# 启动服务
sudo systemctl start etcd.service
```

* 验证

```bash
# 查看集群成员
etcdctl member list

# 查看集群健康状况
etcdctl cluster-health
```
