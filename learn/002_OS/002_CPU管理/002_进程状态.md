# 进程状态


### 进程状态切换

* 新建

1. 用户登陆
2. 作业调度
3. 提供服务
4. 应用请求


* 就绪态

在父进程调用 fork() 后，创建出的进程为就绪态

父进程调用 fork() 返回的是子进程的 pid，子进程得到的 pid 是 0


* 运行态

就绪态的程序得到 CPU 后进入运行态


* 睡眠态

运行态的进程等待资源进入睡眠态，睡眠态的进程拿到资源后进入就绪态

深睡眠：不能被信号唤醒

浅睡眠：除了可以被资源唤醒，还可以被信号唤醒


* 停止态

如：ctrl + z、gdb attach debug 等进入停止态

运行态的程序收到 STOP 信号后进入停止态，停止态的进程收到 CONTINUE 信号后进入就绪态


### 僵尸进程

* 僵尸状态

在进程退出时，其他所依赖的资源都已经释放，task_struct 还没有消失，此时进程为僵尸状态；等待父进程调用 waitpid 获取自己的退出码，如果父进程一直没有调用 waitpid，则子进程一直处于僵尸状态

僵尸状态是一个时间非常短的临界状态


* 如何清理僵尸进程

杀死僵尸进程的父进程


### subreaper 和 托孤

* 注册 subreaper

进程可以通过 prctl(PR_SET_CHILD_SUBREAPER)，将自己设置为 subreaper


* 托孤

当前进程的父进程退出后，当前进程沿进程树向上找到最近的 subreaper，如果没有 subreaper，找到 init 进程
