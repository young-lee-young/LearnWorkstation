# 写时复制（Copy On Write）


### 进程创建

* fork 过程

1. 开始时父进程的数据内存的权限为 RW
2. 执行 fork 时，拷贝一份新的 mm、fs、files、signal，组成新的 task_struct，数据内存权限为 RO
3. 当父进程或子进程在写入数据时，会触发**缺页中断**（page fault）
4. 申请一块新内存，将写入进程的页表修改为新的内存空间，将两个进程的数据内存权限修改为 RW

注意⚠️：写时复制技术依赖 MMU


### vfork

* 使用 vfork 原因

如果是没有 MMU 的 CPU，无法使用 写时复制，没有 fork，只有 vfork


* vfork 使用

使用 vfork，父进程阻塞，直到子进程 exit/exec

执行 vfork 时，会拷贝一份新的 fs、files、signal，但是 mm 指针不变
