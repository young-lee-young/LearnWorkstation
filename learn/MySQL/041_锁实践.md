# 共享锁、排他锁实践


### 数据准备

* 创建表

```mysql
CREATE TABLE `rlock` (
    a INT(8) NOT NULL COMMENT '测试字段'
) ENGINE = InnoDB CHARSET = utf8 COMMENT '测试表';
```


* 插入数据

```mysql
INSERT INTO `rlock` VALUE (1);
INSERT INTO `rlock` VALUE (2);
INSERT INTO `rlock` VALUE (3);
```


### 共享锁

```mysql
# 开启事务 A
BEGIN;

# 加读锁
SELECT * FROM rlock WHERE a = 1 LOCK IN SHARE MODE;
```

上面加上读锁后，此时其他事务再做更新操作会阻塞

```mysql
# 开启事务 B
BEGIN;

# 读操作不会受影响
SELECT * FROM rlock LOCK IN SHARE MODE;

# 写操作会阻塞
UPDATE rlock SET a = 101;
```
