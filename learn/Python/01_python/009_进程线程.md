# 进程、线程、协程

* 线程
* 原子操作
* 进程
* 协程


### 线程（CPU调度的最小单位）

```python
import threading

lock = threading.Lock()
n = [0]


def foo():
	with lock:
	    n[0] = n[0] + 1
	    n[0] = n[0] + 1


threads = []
for i in range(5000):
    t = threading.Thread(target=foo)
    threads.append(t)

for t in threads:
    t.start()

print(n)
```


### 原子操作

* 一个操作如果是一个字节码指令完成就是原子的
* 原子是可以保证线程安全的
* 使用dis分析字节码

```python
import dis


def update_func(l):
    # 线程安全
    l[0] = 1


def add_func(l):
    # 线程不安全
    l[0] += 1


dis.dis(update_func)
dis.dis(add_func)
```


### 进程（资源分配的最小单位）

```python
import multiprocessing


def fib(n):
    if n <= 1:
        return 1
    return fib(n - 1) + fib(n - 2)


for i in range(2, 4):
    p = multiprocessing.Process(target=fib, args=(i,))
    p.start()
```
