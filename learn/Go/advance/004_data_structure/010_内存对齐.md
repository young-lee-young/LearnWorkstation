### 作用

提高内存操作效率，有利于内存原子性


### Go 内存对齐

* 对齐系数

```go
package main

import "fmt"

func main() {
	a := int64(0)
	
	// 使用 Alignof 计算对齐系数
	fmt.Println(unsafe.Alignof(a))
}
```


* 基本类型对齐系数

变量的内存地址必须被对齐系数整除，如对齐系数是 4，表示变量内存地址必须是 4 的倍数


* 结构体对齐系数：保证整个结构体的起始地址

结构体的对齐系数：所有成员的对齐系数的最大值


### 基本类型内存对齐

[基本类型对齐](images/基本类型对齐.png)


### 结构体内存对齐

* 结构体内存对齐

分为**内部对齐**和**结构体之间对齐**


* 内部对齐：考虑成员大小和成员的对齐系数

成员在内存中的顺序是按照声明中顺序固定的

成员的偏移量是自身大小和对齐系数**较小值**的倍数

```go
package main

type Demo struct {
    a bool      // 大小 1，对齐系数 1
    b string    // 大小 16，对齐系数 8
    c int16     // 大小 2，对齐系数 2
}
```

[结构体内部对齐](images/结构体内部对齐.png)


* 结构体长度填充：考虑自身对齐系数和系统字长

结构体长度：最大成员长度（string 16 字节）与系统字长（64 位系统 8 字节）较小值的整数倍


### 节约结构体空间

调整成员顺序，节约空间

```go
// 如上面的 Demo 可以调整为如下顺序
package main

type Demo struct {
    a bool
    c int16
    b string
}
```


### 空结构体对齐

```go
package main

type Demo struct {
    a bool
    z struct{}  // 空结构体出现在结构体中时，地址跟随前一个变量
    c int16
    b string
}
```

```go
package main

type Demo struct {
    a bool
    c int16
    b string
    z struct{}  // 空结构体出现在结构体末尾时，需要补齐字长
}
```
