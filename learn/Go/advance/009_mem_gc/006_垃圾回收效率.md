### GC 触发

* 系统定时触发

sysmon 定时检查：2 分钟内没有 GC，会触发 GC

```go
package runtime

var forcegcperiod int64 = 2 * 60 * 1e9
```

* 用户显示触发

```go
package main

import "runtime"

func main() {
	runtime.GC()
}
```

* 申请内存时触发（runtime/malloc.go/mallocgc()）

```go
package runtime

func mallocgc(size uintptr, typ *_type, needzero bool) unsafe.Pointer {
	
}
```


### GC 优化

* 尽量少在堆上产生垃圾

1. 内存池化
2. 减少逃逸
3. 使用空结构体


### GC 分析工具

```bash
go tool pprof

go tool trace

go build -gcflags="-m"

export GODEBUG="gctrace=1"
```
