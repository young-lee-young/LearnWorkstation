# TCP超时重传

### 重传时间选择

* 问题
  1. 时间过小，导致无意义重传
  2. 时间过大，间隔很长时间才能感知到超时，浪费时间



* 超时重传时间

  RTO = RTTs + 4 * RTTd



* RTTs（加权平均往返时延）

  RTTs = (1 - α) * RTTs + α * RTT

  1. RTTs：加权平均往返时延（第一次取RTT值）
  2. RTT = 本次往返时延
  3. 0 <= α < 1，推荐α取之为1/8
  4. 超时重传时间RTO略大于RTTs

  

* RTTd

  RTTd = (1 - ) * RTTd + b * |RTTs - RTT|

  1. RTTd：RTT偏差加权平均（第一次为RTT一半）
  2. 0 <= < 1，推荐值为1/4



* RTT测量

  1. karn算法：在计算RTTs时，只要重传就不采用RTT样本。这样会有如下问题，假如一段时间内时延增大，在原重传时间内不会收到确认报文，导致重传，但是重传不会更新RTT，RTO也不会更新，导致报文段反复重传
  2. karn算法改进：报文每重传一次，就把超时重传时间RTO增大一些，典型做法是扩大一倍

  ​	

