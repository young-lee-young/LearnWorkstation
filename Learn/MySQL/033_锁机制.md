# MySQL锁机制



### 锁命令

* 加锁、释放锁

```mysql
# 显示加表锁
LOCK TABLES table_name READ/WRITE;

# 显示释放表锁
UNLOCK TABLES;
```

* 显示锁状态

```mysql
# 锁状态输出配置
SHOW VARIABLES LIKE 'innodb_status_output_locks';

# 设置
SET GLOBAL innodb_status_output_locks = 1;
```



### 锁分类



### 自增锁

1. 有自增列，添加数据时锁定，保证自增值唯一
2. 一张表同一时间只有一个自增锁
3. 自增分配后加一，即使事务回滚，子增值不会减



### 乐观锁与悲观锁

乐观锁：直接改数据，更新的时候发现数据已经改变就回滚
悲观锁：先锁数据，再更新


### 锁

* 并发控制

当多个连接对记录进行修改时保证数据的一致性和完整性

* 共享锁（读锁）

在同一时间段内，多个用户可以读取同一资源，读取过程中数据不会发生任何变化

* 排他锁（写锁）

在任何时候只能有一个用户写入资源，当进行写锁时会阻塞其他的读锁或者写锁操作

* 锁颗粒

1. 表锁，是一种开销最小的锁策略
2. 行锁，是一种开销最大的锁策略


锁：

读读：不会有并发安全问题

读写：MVCC

写写：加锁
